# –ü–µ—Å–æ—á–Ω–∏—Ü–∞ Spring Security JWT

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ JWT —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Spring Security 6 –∏ Spring Boot 3. –û–Ω –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∫ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é "Bearer Token", —Ç–∞–∫ –∏ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—É—é "Stateless Cookie" –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º JWE (JSON Web Encryption).

## üöÄ –û–±–∑–æ—Ä

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –º–Ω–æ–≥–æ–º–æ–¥—É–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç Maven:

- **`bearer-authentication`**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–π JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –≥–¥–µ —Ç–æ–∫–µ–Ω—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`. –í–∫–ª—é—á–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É Access –∏ Refresh —Ç–æ–∫–µ–Ω–æ–≤.
- **`cookie-authentication`**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –¥–ª—è SPA, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–≥–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã (JWE), —Ö—Ä–∞–Ω—è—â–∏–µ—Å—è –≤ –∫—É–∫–∞—Ö —Å —Ñ–ª–∞–≥–∞–º–∏ `HttpOnly`, `Secure` –∏ –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `__Host-`.
- **`shared`**: –û–±—â–∏–µ –∫–ª–∞—Å—Å—ã –∏ —É—Ç–∏–ª–∏—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±–æ–∏–º–∏ –º–æ–¥—É–ª—è–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **–Ø–∑—ã–∫**: Java 21
- **–§—Ä–µ–π–º–≤–æ—Ä–∫**: Spring Boot 3.4.2 (Spring Security 6.4, Spring Data JDBC)
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Nimbus JOSE + JWT –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏ (JWS/JWE)
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker & Docker Compose
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–±–æ—Ä–∫–∏**: Maven

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Java 21 –∏–ª–∏ –≤—ã—à–µ
- Maven 3.9+
- Docker –∏ Docker Compose
- SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ HTTPS. –°–º. —Ä–∞–∑–¥–µ–ª [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)).

## üö¶ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Docker Compose –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL. –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ—ë —Å –ø–æ–º–æ—â—å—é:

```bash
docker compose up -d
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### SSL/TLS
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HTTPS. –§–∞–π–ª—ã `application.yml` —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫–ª—é—á–µ–π:

```yaml
server:
  ssl:
    key-store: /path/to/your/keystore/localhost.p12
    key-store-password: password
    key-alias: localhost
```

**TODO**: –í–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∫–ª—é—á–µ–π PKCS12 –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –ø—É—Ç–∏ –≤ `application.yml`, —á—Ç–æ–±—ã –æ–Ω–∏ —É–∫–∞–∑—ã–≤–∞–ª–∏ –Ω–∞ –≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.

#### JWT –ö–ª—é—á–∏
–ö–ª—é—á–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫ JWK (JSON Web Key) –≤ `application.yml`. –í —Ä–∞–±–æ—á–µ–π —Å—Ä–µ–¥–µ –∏—Ö —Å–ª–µ–¥—É–µ—Ç –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∑–∞—â–∏—â–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ–∫—Ä–µ—Ç–æ–≤.

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

#### –ú–æ–¥—É–ª—å Bearer Authentication
```bash
mvn spring-boot:run -pl bearer-authentication
```
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `pro.akosarev.sandbox.SandboxSpringSecurityJwtApplication`

#### –ú–æ–¥—É–ª—å Cookie Authentication
```bash
mvn spring-boot:run -pl cookie-authentication
```
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `pro.akosarev.sandbox.SpaCookieAuthenticationApplication`

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å—É `https://localhost:8443`.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
.
‚îú‚îÄ‚îÄ bearer-authentication/   # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è JWT Bearer —Ç–æ–∫–µ–Ω–æ–≤
‚îú‚îÄ‚îÄ cookie-authentication/   # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è JWT –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫—É–∫ (JWE)
‚îú‚îÄ‚îÄ shared/                  # –û–±—â–∏–µ –º–æ–¥–µ–ª–∏ –∏ –ª–æ–≥–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ compose.yml              # Docker Compose –¥–ª—è PostgreSQL
‚îú‚îÄ‚îÄ pom.xml                  # –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π Maven POM
‚îî‚îÄ‚îÄ LICENSE                  # –õ–∏—Ü–µ–Ω–∑–∏—è MIT
```

## üìú –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –û–±—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `POST /login`: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (–≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∏–ª–∏ –∫—É–∫–∞—Ö).
- `POST /logout`: –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏/—Ç–æ–∫–µ–Ω–∞.

### –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è Cookie Auth
- `GET /csrf`: –ü–æ–ª—É—á–µ–Ω–∏–µ CSRF-—Ç–æ–∫–µ–Ω–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤, –∏–∑–º–µ–Ω—è—é—â–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**TODO**: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã. –ü–æ–º–æ—â—å –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç—Å—è!

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö MIT License ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–º. –≤ —Ñ–∞–π–ª–µ [LICENSE](LICENSE).
