–≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Å–º—ã—Å–ª:

```java
context != null && !(context.getAuthentication() instanceof PreAuthenticatedAuthenticationToken)
```


## –†–∞–∑–±–æ—Ä –ø–æ —á–∞—Å—Ç—è–º:

### 1. `context != null`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—à–µ–ª –∫–∞–∫—É—é-—Ç–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é).

### 2. `!(context.getAuthentication() instanceof PreAuthenticatedAuthenticationToken)`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è **–ù–ï** —è–≤–ª—è–µ—Ç—Å—è `PreAuthenticatedAuthenticationToken`.

## üéØ –°–º—ã—Å–ª –≤—Å–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:

–≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å**, –∞ **–ù–ï —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω**.

## üîë –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ `/jwt/tokens`?

–≠–Ω–¥–ø–æ–∏–Ω—Ç `/jwt/tokens` ‚Äî —ç—Ç–æ —Ç–æ—á–∫–∞ **–ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è** JWT —Ç–æ–∫–µ–Ω–æ–≤. –õ–æ–≥–∏–∫–∞ —Å–ª–µ–¥—É—é—â–∞—è:

```
‚úÖ –†–ê–ó–†–ï–®–ï–ù–û: POST /jwt/tokens —Å –ª–æ–≥–∏–Ω–æ–º/–ø–∞—Ä–æ–ª–µ–º
   ‚Üí Authentication: UsernamePasswordAuthenticationToken
   ‚Üí –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—É—é –ø–∞—Ä—É —Ç–æ–∫–µ–Ω–æ–≤

‚ùå –ó–ê–ü–†–ï–©–ï–ù–û: POST /jwt/tokens —Å JWT —Ç–æ–∫–µ–Ω–æ–º
   ‚Üí Authentication: PreAuthenticatedAuthenticationToken
   ‚Üí –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø–∞—Ä—É —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞
```


## üìä –†–∞–∑–ª–∏—á–∏–µ —Ç–∏–ø–æ–≤ Authentication:

| –°–∏—Ç—É–∞—Ü–∏—è | –¢–∏–ø Authentication | –ú–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω—ã? |
|----------|-------------------|------------------------|
| –í—Ö–æ–¥ —á–µ—Ä–µ–∑ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å | `UsernamePasswordAuthenticationToken` | ‚úÖ –î–ê |
| –ó–∞–ø—Ä–æ—Å —Å Access Token | `PreAuthenticatedAuthenticationToken` | ‚ùå –ù–ï–¢ |
| –ó–∞–ø—Ä–æ—Å —Å Refresh Token | `PreAuthenticatedAuthenticationToken` | ‚ùå –ù–ï–¢ |

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π:

–≠—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—é:

```java
// ‚ùå –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—É—é –ø–∞—Ä—É —Ç–æ–∫–µ–Ω–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω
POST /jwt/tokens
Authorization: Bearer <existing_access_token>

// –ë–µ–∑ —ç—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã
// –≠—Ç–æ –Ω–∞—Ä—É—à–∏–ª–æ –±—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã
```


## üí° –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π flow:

```java
// 1Ô∏è‚É£ –ü–µ—Ä–≤–∏—á–Ω—ã–π –≤—Ö–æ–¥ (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å)
POST /jwt/tokens + Basic Auth
‚Üí UsernamePasswordAuthenticationToken ‚úÖ
‚Üí –ü–æ–ª—É—á–∞–µ–º Access + Refresh —Ç–æ–∫–µ–Ω—ã

// 2Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç!)
POST /jwt/refresh + Bearer <refresh_token>
‚Üí PreAuthenticatedAuthenticationToken ‚úÖ
‚Üí –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤—ã–π Access Token
```


–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è: **–ø–µ—Ä–≤–∏—á–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é** (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å) –∏ **—Ä–∞–±–æ—Ç—É —Å —Ç–æ–∫–µ–Ω–∞–º–∏** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `/jwt/refresh`).